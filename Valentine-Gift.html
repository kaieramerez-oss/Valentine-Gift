<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Pixel Valentine</title>

<style>
    body {
        margin: 0;
        height: 100vh;
        background: #111;
        color: white;
        font-family: monospace;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        text-align: center;
    }

    canvas {
        background: #222;
        border: 6px solid #ff4d6d;
        image-rendering: pixelated;
        width: 800px;
        height: 500px;
        max-width: 95vw;
        max-height: 70vh;
    }

    button {
        padding: 10px 24px;
        font-size: 18px;
        border: none;
        border-radius: 10px;
        background: #00e676;
        cursor: pointer;
        margin-bottom: 10px;
        font-family: monospace;
    }
</style>
</head>

<body>

<h1> WILL YOU BE MY VALENTINE? </h1>
<p>WASD â€¢ Reach YES ðŸ’š</p>

<button id="start">â–¶ START GAME</button>
<canvas id="game" width="160" height="100" style="display:none;"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
ctx.imageSmoothingEnabled = false;

const TILE = 10;

// Sprites
const heartSprite = [
 "01100110",
 "11111111",
 "11111111",
 "01111110",
 "00111100",
 "00011000"
];

const bossSprite = [
 "111111",
 "101101",
 "111111",
 "110011",
 "101101",
 "111111"
];

const yesSprite = [
 "010",
 "111",
 "010"
];

const flowerSprite = [
 "010",
 "111",
 "010"
];

// Variables
const levels = [
[
"1111111111111111",
"1000000000000001",
"1011110111111101",
"1000010001000001",
"1111011101011101",
"1000010001000001",
"1011110111111101",
"1000000000000001",
"1000000000000001",
"1111111111111111"
],
[
"1111111111111111",
"1000001000000001",
"1011101011111101",
"1000101000000101",
"1110101111100101",
"1000100000100101",
"1011111110100101",
"1000000000000001",
"1000000000000001",
"1111111111111111"
],
[
"1111111111111111",
"1000000000000001",
"1011111111111101",
"1000000000000101",
"1011111111110101",
"1010000000000101",
"1010111111111101",
"1000000000000001",
"1000000000000001",
"1111111111111111"
],
[
"1111111111111111",
"1000000001000001",
"1011111101011101",
"1010000101010001",
"1010110101010111",
"1000100100010001",
"1011101111111101",
"1000000000000001",
"1000000000000001",
"1111111111111111"
],
[
"1111111111111111",
"1000000000000001",
"1011111110111101",
"1000000010100001",
"1111111010101111",
"1000000010100001",
"1011111110111101",
"1000000000000001",
"1000000000000001",
"1111111111111111"
]
];

let level = 0;
let keys = {};
let hp = 3;
let running = false;
let ending = false;

let player, boss, goal;
let flowers = [];

// Start game
document.getElementById("start").onclick = () => {
    running = true;
    canvas.style.display = "block";
    document.getElementById("start").style.display = "none";
    loadLevel();
    requestAnimationFrame(loop);
};

// Key events
document.addEventListener("keydown", e => keys[e.key.toLowerCase()] = true);
document.addEventListener("keyup", e => keys[e.key.toLowerCase()] = false);

// Load level
function loadLevel() {
    player = { x: 10, y: 10, w: 8, h: 6, speed: 1 };
    boss = { x: 120, y: 80, w: 6, h: 6, speed: 0.15 + level * 0.05 };
    goal = { x: 140, y: 10, w: 3, h: 3 };
}

// Collision with walls
function isWall(px, py) {
    const tx = Math.floor(px / TILE);
    const ty = Math.floor(py / TILE);
    return levels[level][ty][tx] === "1";
}

// Player movement
function movePlayer() {
    let nx = player.x;
    let ny = player.y;

    if (keys["w"]) ny -= player.speed;
    if (keys["s"]) ny += player.speed;
    if (keys["a"]) nx -= player.speed;
    if (keys["d"]) nx += player.speed;

    if (!isWall(nx, player.y)) player.x = nx;
    if (!isWall(player.x, ny)) player.y = ny;
}

// Boss movement
function moveBoss() {
    boss.x += Math.sign(player.x - boss.x) * boss.speed;
    boss.y += Math.sign(player.y - boss.y) * boss.speed;
}

// Rectangle collision
function collide(a, b) {
    return (
        a.x < b.x + b.w &&
        a.x + a.w > b.x &&
        a.y < b.y + b.h &&
        a.y + a.h > b.y
    );
}

// Draw map
function drawMap() {
    ctx.fillStyle = "#444";
    levels[level].forEach((row, y) => {
        [...row].forEach((cell, x) => {
            if (cell === "1") ctx.fillRect(x * TILE, y * TILE, TILE, TILE);
        });
    });
}

// Draw sprite
function drawSprite(sprite, x, y, color) {
    ctx.fillStyle = color;
    sprite.forEach((row, ry) => {
        [...row].forEach((p, rx) => {
            if (p === "1") ctx.fillRect(x + rx, y + ry, 1, 1);
        });
    });
}

// Draw flowers
function spawnFlower() {
    flowers.push({
        x: Math.random() * canvas.width,
        y: canvas.height + Math.random() * 20,
        speed: 0.2 + Math.random() * 0.4
    });
}

function updateFlowers() {
    flowers.forEach(f => f.y -= f.speed);
    flowers = flowers.filter(f => f.y > -10);
}

function drawFlowers() {
    flowers.forEach(f => drawSprite(flowerSprite, f.x, f.y, "#b388ff"));
}

// Draw everything
function draw() {
    ctx.clearRect(0,0,canvas.width,canvas.height);
    drawMap();
    drawSprite(heartSprite, player.x, player.y, "#ff4d6d");
    drawSprite(bossSprite, boss.x, boss.y, "#aaa");
    drawSprite(yesSprite, goal.x, goal.y, "#00e676");

    ctx.fillStyle = "white";
    ctx.fillText(`HP:${hp}  LVL:${level+1}  EASY`, 2, 8);
}

// Ending flower animation
function flowerEnding() {
    ctx.fillStyle = "rgba(0,0,0,0.25)";
    ctx.fillRect(0,0,canvas.width,canvas.height);

    spawnFlower();
    updateFlowers();
    drawFlowers();

    ctx.fillStyle = "white";
    ctx.fillText("ðŸ’– TRUE LOVE ðŸ’–", 45, 40);
    ctx.fillText("Love mo talaga ako ah", 30, 55);

    if (ending) requestAnimationFrame(flowerEnding);
}

// Game loop
function loop() {
    if (!running) return;

    movePlayer();
    moveBoss();

    if (collide(player, boss)) {
        hp--;
        loadLevel();
        if (hp <= 0) {
            document.body.innerHTML = "<h1>ðŸ’€ DI MO NAKO LOVE??? ðŸ’€</h1>";
            return;
        }
    }

    if (collide(player, goal)) {
        level++;
        if (level >= levels.length) {
            ending = true;
            running = false;
            ctx.clearRect(0,0,canvas.width,canvas.height);
            flowerEnding();
            return;
        }
        loadLevel();
    }

    draw();
    requestAnimationFrame(loop);
}
</script>

</body>
</html>
